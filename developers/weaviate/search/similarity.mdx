---
title: Similarity search
sidebar_position: 2
image: og/docs/howto.jpg
# tags: ['how to', 'perform a similarity search']
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import FilteredTextBlock from '@site/src/components/Documentation/FilteredTextBlock';
import PythonCode from '!!raw-loader!/_includes/code/howto/similarity.py';
import TypeScriptCode from '!!raw-loader!/_includes/code/howto/similarity.ts';

## Overview

This page shows you how to perform similarity-based searches using Weaviate, using `nearXXX` parameters. See [this page instead](./hybrid.mdx) for `hybrid` searches.

:::info Related pages
- [API References: Vector search parameters](../api/graphql/vector-search-parameters.md)
:::

import BasicPrereqs from '/_includes/prerequisites-quickstart.md';

<BasicPrereqs />

## Similarity-based parameters

These parameters are available:

* [`near<Media>`](#an-input-medium) - Finds objects closest to an input medium:
    * E.g.: Use it to find text objects most similar to `cute animals`, or images most similar to a particular image.
* [`nearObject`](#an-object) - Finds objects closest to another Weaviate object:
    * E.g.: Use it to find Weaviate objects most similar to object `56b9449e-65db-5df4-887b-0a4773f52aa7`.
* [`nearVector`](#a-vector) - Find objects closest to an input vector.
    * E.g.: Use it to find Weaviate objects most similar to vector `[-0.368, 0.1397, ... , 0.0971]`.

### An input medium

:::tip This is only available for classes with a [vectorizer](../modules/retriever-vectorizer-modules/index.md) configured.
:::

You can use these parameters to find objects most similar to a raw (un-vectorized) input, such as text or image. For text objects, you can provide an input text to [`nearText`](../api/graphql/vector-search-parameters.md#neartext), and for image objects, you can provide an input image to [`nearImage`](../modules/retriever-vectorizer-modules/img2vec-neural.md#nearimage-search). (Or either if you are using [CLIP](../modules/retriever-vectorizer-modules/multi2vec-clip.md).)

The example below searches the `JeopardyQuestion` class for the top 2 objects best matching `"animals in movies"`, using `nearText`:

<Tabs groupId="languages">
<TabItem value="graphql" label="GraphQL">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# GraphQL Query using nearText"
  endMarker="# END GraphQL Query using nearText"
  language="graphql"
/>
</TabItem>
<TabItem value="py" label="Python">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# Query using nearText"
  endMarker="# END Query using nearText"
  language="python"
/>
</TabItem>
<TabItem value="ts" label="TypeScript">
<FilteredTextBlock
  text={TypeScriptCode}
  startMarker="// Query using nearText"
  endMarker="// Query using nearVector"
  language="typescript"
/>
</TabItem>
</Tabs>

<details>
  <summary>Example response</summary>

It should produce a response such as this:

<FilteredTextBlock
  text={PythonCode}
  startMarker="# Expected nearText results"
  endMarker="# END Expected nearText results"
  language="python"
/>

</details>

### An object

You can use the [`nearObject` parameter](../api/graphql/vector-search-parameters.md#nearobject) to find objects most similar to an existing Weaviate object, by specifying the object ID (e.g. `56b9449e-65db-5df4-887b-0a4773f52aa7`).

:::tip How to retrieve object IDs
See [this section](./basics.mdx#retrieve-the-object-id)
:::

The example below searches the `JeopardyQuestion` class for the top 2 objects best matching the object with ID `56b9449e-65db-5df4-887b-0a4773f52aa7`, using `nearObject`:

<Tabs groupId="languages">
<TabItem value="graphql" label="GraphQL">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# GraphQL Query using nearObject"
  endMarker="# END GraphQL Query using nearObject"
  language="graphql"
/>
</TabItem>
<TabItem value="py" label="Python">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# Query using nearObject"
  endMarker="# END Query using nearObject"
  language="python"
/>
</TabItem>
<TabItem value="ts" label="TypeScript">
<FilteredTextBlock
  text={TypeScriptCode}
  startMarker="// Query using nearObject"
  endMarker="// Limit"
  language="typescript"
/>
</TabItem>
</Tabs>

Note that the first result is always the same object.
<!-- TODO: you can technically pass the ID of an object outside of the collection in order to find similar objects across collections. -->


### A vector

You can use the [`nearVector` parameter](../api/graphql/vector-search-parameters.md#nearvector) to find objects most similar to an input vector (e.g. `[-0.368, 0.1397, ... , 0.0971]`).

The example below searches the `JeopardyQuestion` class for the top 2 objects best matching the object with the provided vector, using `nearVector`:

<Tabs groupId="languages">
<TabItem value="graphql" label="GraphQL">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# GraphQL Query using nearVector"
  endMarker="# END GraphQL Query using nearVector"
  language="graphql"
/>
</TabItem>
<TabItem value="py" label="Python">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# Query using nearVector"
  endMarker="# END Query using nearVector"
  language="python"
/>
</TabItem>
<TabItem value="ts" label="TypeScript">
<FilteredTextBlock
  text={TypeScriptCode}
  startMarker="// Query using nearVector"
  endMarker="// Query using nearObject"
  language="python"
/>
</TabItem>
</Tabs>


## Limit the results

You can set a limit on:
- The number of results returned (with `limit`), or
- How (dis)similar the results are to the query (with `distance` or `certainty`).

### Number of results

You can set the maximum number of results returned with `limit` in the same way as shown in the [search basics how-to guide](./basics.mdx#limit-returned-objects).

Similarly, you can retrieve a maximum `n` objects after the first `m` results by using `limit` with `offset` as shown in the [search basics how-to guide](./basics.mdx#limit-with-offset).

To limit the number of results returned by a `near...` query, add the limit parameter. To start at a given offset, add the `offset` parameter. For example if we want to obtain the animals in movies #2 and #3 from the [`nearText` example](#an-input-medium) above, we'll need to use `offset: 1, limit: 2`:

The example below searches the `JeopardyQuestion` class for objects best matching `"animals in movies"`, skips 1 object (`offset`) and returns the next 2 objects:

<Tabs groupId="languages">
<TabItem value="graphql" label="GraphQL">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# GraphQL Query with LimitOffset"
  endMarker="# END GraphQL Query with LimitOffset"
  language="graphql"
/>
</TabItem>
<TabItem value="py" label="Python">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# Query with LimitOffset"
  endMarker="# END Query with LimitOffset"
  language="python"
/>
</TabItem>
<TabItem value="ts" label="TypeScript">
<FilteredTextBlock
  text={TypeScriptCode}
  startMarker="// Limit"
  endMarker="// Distance"
  language="typescript"
/>
</TabItem>
</Tabs>


### Distance threshold

You can set a threshold for similarity search by setting a maximum `distance`. The distance indicates how dissimilar two objects are.

Multiple [distance metrics](../config-refs/distances.md) are available in Weaviate. You can set it in the schema [as shown here](../config-refs/schema.mdx#default-distance-metric).

The example below searches the `JeopardyQuestion` class for objects best matching `"animals in movies"`, returning those with a `distance` less than `0.18`:

<Tabs groupId="languages">
<TabItem value="graphql" label="GraphQL">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# GraphQL Query with Distance"
  endMarker="# END GraphQL Query with Distance"
  language="graphql"
/>
</TabItem>
<TabItem value="py" label="Python">
<FilteredTextBlock
  text={PythonCode}
  startMarker="# Query with Distance"
  endMarker="# END Query with Distance"
  language="python"
/>
</TabItem>
<TabItem value="ts" label="TypeScript">
<FilteredTextBlock
  text={TypeScriptCode}
  startMarker="// Limit"
  endMarker="// Distance"
  language="typescript"
/>
</TabItem>
</Tabs>

:::tip Using `certainty` possible for `cosine` distance metric only
If the distance metric is set as `cosine` the [`certainty`](../config-refs/distances.md#distance-vs-certainty) variable can be used, which normalizes the complement of distance to a value between 0 and 1.
:::


## Group results by a property

TODO:
`Get` + `near<>` + `limit` + `groupBy`

## Add a Boolean (`where`) filter

TODO:
Show one `Get` + `near<>` + `where` example

TODO[where is that]: Link to `where` filter howto page.

## How to run these snippets

* `distance` - the [distance](../api/graphql/additional-properties.md#distance) in vector space between the query vector and each result. Results are sorted ascending by distance - the lower the distance the closer the result is to the query, so the best results come first.
* `certainty` - another measure of similarity, which you can [read more about](../api/graphql/additional-properties.md#certainty-only-for-cosine-distance)

We have prepared an illustrative dataset of [Jeopardy!](https://en.wikipedia.org/wiki/Jeopardy!) Q&As that we'll be using for the examples below. You can explore the collection using the Weaviate Cloud Services Console and connecting to `https://edu-demo.weaviate.network`. In the <kbd>Headers</kbd> section, add the following authorization entry:

```json
{
  "Authorization": "Bearer learn-weaviate"
}
```

The quiz objects have been vectorized with OpenAI' <nobr>[`text-embedding-ada-002` model](https://platform.openai.com/docs/guides/embeddings/what-are-embeddings)</nobr>, so you'll need an [OpenAI API key](https://platform.openai.com/account/api-keys) for the `nearText` part of this howto right below.

## More Resources

import DocsMoreResources from '/_includes/more-resources-docs.md';

<DocsMoreResources />
